# This is a GNU makefile

# from running ./configure [--prefix=/my/prefix]
-include config

####################################################
#  CONFIGURATION if file config does not exist
####################################################
# This following can be overridden of changed here
# via include file prefix which may be generated by
# running ./configure --prefix=/my/prefix
PREFIX ?= /usr/local/encap/demoRunner-0.0

WS_VERSION = ws@1.1.1 # This version of ws works
####################################################


# Stuff we install in BIN
private_files = \
 $(wildcard etc/*.htm etc/*.js etc/*.css etc/*.png etc/*.jpg)\

BIN = $(PREFIX)/bin
ETC = $(PREFIX)/etc

# We npm install a copy of ws for development
build:
	npm install $(WS_VERSION)

mkdirs:
	rm -rf $(ETC) $(BIN) && mkdir -p $(ETC) $(BIN)


# The current version of socket.io seems to be broken when used
# with firefox and chromium-browser.  So we are trying nodejs 'ws'
# WebSockets.
install: mkdirs
	cp  -r $(private_files) $(ETC)/
	cp demoRunner-server $(BIN)/
	cd $(BIN)/ && npm install $(WS_VERSION)
	echo "etc" > $(PREFIX)/encap.exclude
	echo "node_modules" > $(BIN)/encap.exclude

clean:
	rm -rf node_modules config

